{"cells":[{"cell_type":"markdown","metadata":{"id":"KDLfjvWjGCsx"},"source":["# Prepare dataset\n","The purpose of this file is to normalize dataset to have same size along the whole dataset in one run."]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5fIgY_LvITQA","executionInfo":{"status":"ok","timestamp":1651548049635,"user_tz":-60,"elapsed":54786,"user":{"displayName":"Jennifer Ikeoha","userId":"11067017096689304888"}},"outputId":"e4df512c-4c1e-4d86-ebd1-961178d0f3d5"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"markdown","metadata":{"id":"6xvNcKzlGCs2"},"source":["## Create list of all files to cut"]},{"cell_type":"code","source":["cd /content/drive/MyDrive/Bird Classification Project/birds2"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Fu7JsmVsW66P","executionInfo":{"status":"ok","timestamp":1651548054080,"user_tz":-60,"elapsed":651,"user":{"displayName":"Jennifer Ikeoha","userId":"11067017096689304888"}},"outputId":"b128568f-0efe-416f-da9d-884aa3a53c59"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["/content/drive/.shortcut-targets-by-id/1r_HgRiKRZHwJcStR8zTURfF969Cllxc8/birds2\n"]}]},{"cell_type":"code","source":["import os\n","print(len(os.listdir(\"/content/drive/MyDrive/Bird Classification Project/birds2/data/train/Cardueliscarduelis\")))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ORXp-wA33QfA","executionInfo":{"status":"ok","timestamp":1651548060687,"user_tz":-60,"elapsed":4650,"user":{"displayName":"Jennifer Ikeoha","userId":"11067017096689304888"}},"outputId":"b428c785-a341-4117-b334-98da57967a02"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["326\n"]}]},{"cell_type":"code","execution_count":null,"metadata":{"scrolled":false,"id":"w97DR8DfGCs3","outputId":"e6574a0b-3687-4b4f-9c5a-96b39a9cb011","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1651541424609,"user_tz":-60,"elapsed":1038,"user":{"displayName":"Jennifer Ikeoha","userId":"11067017096689304888"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["1 . Found  1  files for  3 ( 1 )\n","['3']\n","./data/another trial/3\n"]}],"source":["%matplotlib inline\n","import matplotlib\n","matplotlib.interactive(False)\n","matplotlib.use('Agg')\n","\n","# find all of the files in the directory\n","import os\n","import gc\n","basePath=\"./data/another trial/\"\n","melsPath= \"./data/mels-Acro-trial/\"\n","\n","birds=[] # list of all birds\n","for root, dirs, files in os.walk(basePath):\n","    if root == basePath:\n","        birds=dirs\n","birds50=[]                \n","flist=[] # list of all files\n","blist=[] # list of files for one bird \n","i50=0;\n","for i, bird in enumerate(birds):\n","    for root, dirs, files in os.walk(basePath+bird):\n","        for file in files:\n","            if file.endswith(\".mp3\"):\n","                blist.append(os.path.join(root, file))\n","    if len(blist) >0:\n","        i50 = i50+1;\n","        print(i50, \". Found \", len(blist), ' files for ', bird ,'(',i+1,')')\n","        birds50.append(bird)\n","        flist.append(blist)\n","    blist=[]\n","print(birds50) \n","print(root)"]},{"cell_type":"markdown","metadata":{"id":"mc8gq4JHGCs7"},"source":["## Chunk  the file\n","Cut mel spectrogram files to smaller pieces of 5 seconds in example and stride of 1 second. Stride tells us how different pieces of files will overlap at each other."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"s6h5eA4BGCs7"},"outputs":[],"source":["def saveMel(signal, directory):\n","    gc.enable()\n","    # MK_spectrogram modified\n","    N_FFT = 1024         # \n","    HOP_SIZE = 1024      #  \n","    N_MELS = 128          # Higher   \n","    WIN_SIZE = 1024      # \n","    WINDOW_TYPE = 'hann' # \n","    FEATURE = 'mel'      # \n","    FMIN = 1400\n","\n","    fig = plt.figure(1,frameon=False)\n","    fig.set_size_inches(6,6)\n","\n","    ax = plt.Axes(fig, [0., 0., 1., 1.])\n","    ax.set_axis_off()\n","    fig.add_axes(ax)\n","    \n","    S = librosa.feature.melspectrogram(y=signal, sr=sr,\n","                                        n_fft=N_FFT,\n","                                        hop_length=HOP_SIZE, \n","                                        n_mels=N_MELS, \n","                                        htk=True, \n","                                        fmin=FMIN, # higher limit ##high-pass filter freq.\n","                                        fmax=sr/2) # AMPLITUDE\n","    librosa.display.specshow(librosa.power_to_db(S**2,ref=np.max), fmin=FMIN) #power = S**2\n","\n","    fig.savefig(directory)\n","    plt.ioff()\n","    #plt.show(block=False)\n","    fig.clf()\n","    ax.cla()\n","    plt.clf()\n","    plt.close('all')"]},{"cell_type":"code","execution_count":null,"metadata":{"scrolled":false,"id":"wvv9n1qDGCs9","outputId":"cb1669cb-4aac-4054-a736-1239fd38ed6e","colab":{"referenced_widgets":["a65d444be84e4a6d95da75070a2883ee","d25d32a5b0e643ec983cc811342d775e","35efa7fbadfa4356af022420d44bdcca","f63c98d71cf040b09a33685032589ac6","7a4c6b72a65940768ed49fd48975e088","78c6e13b1bcf43df9d6a1b2605fdf2ee","30ba17c9f01346a3a8eff67dfa5967ff","7a3f5f65e50e43be9f733d07fa4a5f0b","cbb8ec8569c04d62b900cac75abcd198","0a8c8ea59190429fbca0e94deb9d84a5","56b304c729054ce4b338350ea8a5b9a7"],"base_uri":"https://localhost:8080/","height":102},"executionInfo":{"status":"ok","timestamp":1651541462743,"user_tz":-60,"elapsed":38135,"user":{"displayName":"Jennifer Ikeoha","userId":"11067017096689304888"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Number of directories to check and cut:  1\n","Processing  0 .  3 ...\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"a65d444be84e4a6d95da75070a2883ee"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Number of files after cutting: \n"]}],"source":["import warnings\n","warnings.filterwarnings('ignore')\n","\n","import sys\n","from tqdm import tqdm_notebook as tqdm\n","import librosa\n","import librosa.display\n","import numpy as np\n","import matplotlib.pyplot as plt\n","\n","size = {'desired': 5, # [seconds]\n","        'minimum': 4, # [seconds]\n","        'stride' : 0, # [seconds]\n","        'name': 5 # [number of letters]\n","       } # stride should not be bigger than desired length\n","\n","print('Number of directories to check and cut: ', len(flist))\n","\n","#step = (size['desired']-size['stride'])*sr # length of step between two cuts in seconds\n","step=1\n","if step>0:\n","    for bird, birdList in enumerate(flist):\n","        print(\"Processing \",bird,'. ', birds50[bird], \"...\")\n","        for birdnr, path in tqdm(enumerate(birdList)):\n","            # load the mp3 file\n","            directory=melsPath+str(bird)+birds50[bird][:size['name']]+\"/\"\n","\n","            if not os.path.exists(directory):\n","                os.makedirs(directory)\n","                \n","            if not os.path.exists(directory+path.rsplit('/',1)[1].replace(' ', '')[:-4]+\"1_1.png\"):\n","                  \n","                signal, sr = librosa.load(path) # sr = sampling rate\n","                step = (size['desired']-size['stride'])*sr # length of step between two cuts in seconds\n","                \n","                nr=0;\n","                for start, end in zip(range(0,len(signal),step),range(size['desired']*sr,len(signal),step)):\n","                    # cut file and save each piece\n","                    nr=nr+1\n","                    # save the file if its length is higher than minimum\n","                    if end-start > size['minimum']*sr:\n","                        melpath=path.rsplit('/',1)[1]\n","                        melpath=directory+melpath.replace(' ', '')[:-4]+str(nr)+\"_\"+str(nr)+\".png\"\n","                        saveMel(signal[start:end],melpath)\n","                    #print('New file...',start/sr,' - ',end/sr)\n","                    #print('Start: ',start,'end: ', end, 'length: ', end-start)\n","                \n","            pass\n","else:    \n","    print(\"Error: Stride should be lower than desired length.\")\n","    \n","print('Number of files after cutting: ')\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fkZlbVzEGCs-","outputId":"b480850d-c88d-4bc2-93bd-8b0eb10ce68e","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1651508517009,"user_tz":-60,"elapsed":901,"user":{"displayName":"Jennifer Ikeoha","userId":"11067017096689304888"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["['0Cardu']\n","[]\n","Found  15222  files\n"]}],"source":["# Test\n","import matplotlib.image as mpimg\n","ilist=[]\n","for root, dirs, files in os.walk(melsPath):\n","    print(dirs)\n","    for file in files:\n","        if file.endswith(\".png\"):\n","            ilist.append(os.path.join(root, file))\n","img=mpimg.imread(ilist[0])\n","imgplot = plt.imshow(img)\n","plt.show()\n","img=mpimg.imread(ilist[100])\n","imgplot = plt.imshow(img)\n","plt.show()\n","img=mpimg.imread(ilist[1000])\n","imgplot = plt.imshow(img)\n","plt.show()\n","img=mpimg.imread(ilist[15000])\n","imgplot = plt.imshow(img)\n","plt.show()\n","print(\"Found \",len(ilist),\" files\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"9yhCMaUEGCs-"},"outputs":[],"source":["#print(path)\n","#os.remove(path)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"7fvOpEUSGCs_"},"outputs":[],"source":[""]}],"metadata":{"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.7.3"},"colab":{"name":"PrepareData.ipynb","provenance":[{"file_id":"13dQyAKVgC4b8VFhDcw0qzQifik8pxvmE","timestamp":1651500895617}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"a65d444be84e4a6d95da75070a2883ee":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_d25d32a5b0e643ec983cc811342d775e","IPY_MODEL_35efa7fbadfa4356af022420d44bdcca","IPY_MODEL_f63c98d71cf040b09a33685032589ac6"],"layout":"IPY_MODEL_7a4c6b72a65940768ed49fd48975e088"}},"d25d32a5b0e643ec983cc811342d775e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_78c6e13b1bcf43df9d6a1b2605fdf2ee","placeholder":"​","style":"IPY_MODEL_30ba17c9f01346a3a8eff67dfa5967ff","value":""}},"35efa7fbadfa4356af022420d44bdcca":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_7a3f5f65e50e43be9f733d07fa4a5f0b","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_cbb8ec8569c04d62b900cac75abcd198","value":1}},"f63c98d71cf040b09a33685032589ac6":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0a8c8ea59190429fbca0e94deb9d84a5","placeholder":"​","style":"IPY_MODEL_56b304c729054ce4b338350ea8a5b9a7","value":" 1/? [00:36&lt;00:00, 36.01s/it]"}},"7a4c6b72a65940768ed49fd48975e088":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"78c6e13b1bcf43df9d6a1b2605fdf2ee":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"30ba17c9f01346a3a8eff67dfa5967ff":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"7a3f5f65e50e43be9f733d07fa4a5f0b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"cbb8ec8569c04d62b900cac75abcd198":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"0a8c8ea59190429fbca0e94deb9d84a5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"56b304c729054ce4b338350ea8a5b9a7":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"nbformat":4,"nbformat_minor":0}